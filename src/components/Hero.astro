---
const res = await fetch(
  "https://strapi-production-4f4b.up.railway.app/api/soberania-energeticas?sort=fecha:desc"
);
const { data } = await res.json();

const record = data?.[0];

const ahorroPesos = record?.ahorro_pesos ?? 0;
const precioKWh = 209;
const energiaAhorradaKWh =
  record?.energia_ahorrada_kwh ?? ahorroPesos / precioKWh;
---

<section class="h-svh bg-[#ffdc8a]">
  <div
    class="px-3 md:px-6 lg:px-10.75 pt-[60px] h-[calc(100%-50px)] md:h-[calc(100%-60px)]"
  >
    <div class="border-[#FFFFFFB2] border-x relative h-full">
      <div class="relative w-full h-full overflow-hidden">
        <img
          id="hero-bg-1"
          class="absolute top-0 left-0 w-full h-full object-cover opacity-100"
        />

        <img
          id="hero-bg-2"
          class="absolute top-0 left-0 w-full h-full object-cover opacity-0"
        />
      </div>

      <div
        class="flex flex-col items-center justify-center absolute text-center top-0 left-0 w-full h-full"
      >
        <h1
          class="text-[2.75rem] sm:text-[3.25rem] md:text-[6.75rem] text-[#ffdc8a] font-lato font-bold select-none overflow-y-hidden"
        >
          <span
            class="inline-block leading-none sm:leading-0 tracking-[-0.11rem] md:tracking-[-0.23rem]"
            >Municipalidad de Alberti
          </span>
        </h1>

        <p
          class="text-[2rem] sm:text-[2.25rem] md:text-[4.75rem] text-[#ffdc8a] font-neuton font-semibold select-none overflow-y-hidden mt-4 md:mt-0"
        >
          Soberanía Energética
        </p>
        <h5
          class="text-[1.25rem] md:text-[2.75rem] text-[#ffdc8a] font-lato font-semibold select-none max-w-2xl mt-8 overflow-y-hidden text-left"
        >
          <span
            >- Generamos {
              Number(energiaAhorradaKWh.toFixed(2)).toLocaleString("es-AR")
            } kWh</span
          >

          <span class="block"
            >- Ahorramos ${
              Number(ahorroPesos.toFixed(2)).toLocaleString("es-AR")
            }</span
          >
        </h5>
      </div>
    </div>
  </div>
  <div
    class="flex items-center justify-center h-[50px] md:h-[60px] border-t border-[#FFFFFFB2] relative"
  >
    <div
      class="h-full absolute left-3 md:left-6 lg:left-10.75 w-px bg-[#FFFFFFB2]"
    >
    </div>
    <div
      class="h-full absolute right-3 md:right-6 lg:right-10.75 w-px bg-[#FFFFFFB2]"
    >
    </div>
    <div class="animate-bounce">
      <img
        alt="Down Arrow"
        loading="lazy"
        width="14"
        height="10"
        decoding="async"
        src="https://www.bbc.com/storyworks/specials/humanising-energy/assets/images/icons/scroll_icon.svg"
      />
    </div>
    <p
      class="pl-2 font-bold md:pl-3 text-[0.75rem] text-[#253366] uppercase font-neuton tracking-[0.0625rem]"
    >
      Desliza para descubrir más
    </p>
  </div>
</section>

<script>
  import { gsap } from "gsap";
  import { SplitText } from "gsap/SplitText";

  import img_1 from "../assets/images/paneles/img (1).jpg";
  import img_2 from "../assets/images/paneles/img (2).jpg";
  import img_3 from "../assets/images/paneles/img (3).jpg";
  import img_4 from "../assets/images/paneles/img (4).jpg";
  import img_5 from "../assets/images/paneles/img (5).jpg";
  import img_6 from "../assets/images/paneles/img (6).jpg";
  import img_7 from "../assets/images/paneles/img (7).jpg";
  import img_8 from "../assets/images/paneles/img (8).jpg";
  import img_9 from "../assets/images/paneles/img (9).jpg";
  import img_10 from "../assets/images/paneles/img (10).jpg";

  const images = [
    img_1.src,
    img_2.src,
    img_3.src,
    img_4.src,
    img_5.src,
    img_6.src,
    img_7.src,
    img_8.src,
    img_9.src,
    img_10.src,
  ];

  const img1 = document.getElementById("hero-bg-1") as HTMLImageElement;
  const img2 = document.getElementById("hero-bg-2") as HTMLImageElement;

  let current = 0;
  let showingImg1 = true;

  // Imagen inicial
  img1.src = images[current];

  const changeImage = () => {
    const next = (current + 1) % images.length;
    const incoming = showingImg1 ? img2 : img1;
    const outgoing = showingImg1 ? img1 : img2;

    // Pre-cargamos la próxima imagen
    incoming.src = images[next];

    // Fade crossfade
    gsap.to(incoming, {
      opacity: 1,
      duration: 1.8,
      ease: "power2.out",
    });

    gsap.to(outgoing, {
      opacity: 0,
      duration: 1.5,
      ease: "power2.out",
    });

    current = next;
    showingImg1 = !showingImg1;
  };

  setInterval(changeImage, 5000);

  gsap.registerPlugin(SplitText);

  let typeSplit = new SplitText(".title-1", { type: "chars" });

  gsap.from(typeSplit.chars, {
    y: "100%",
    opacity: 0,
    duration: 1,
    ease: "power3.out",
    stagger: 0.1,
  });

  let typeSplit_2 = new SplitText(".title-2", { type: "chars" });

  gsap.from(typeSplit_2.chars, {
    y: "100%",
    opacity: 0,
    duration: 1,
    ease: "power3.out",
    delay: 0.5,
    stagger: 0.1,
  });

  let subtitleSplit = new SplitText(".subtitle", { type: "words" });

  gsap.from(subtitleSplit.words, {
    y: "100%",
    opacity: 0,
    duration: 1,
    ease: "power3.out",
    delay: 2,
    stagger: 0.1,
  });
</script>
